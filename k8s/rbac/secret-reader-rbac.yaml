# =============================================================================
# RBAC Configuration for Cross-Namespace Secret Access
# =============================================================================
# This allows the search-infrastructure namespace to read secrets from
# the 'pg' and 'redis' namespaces.
# =============================================================================

---
# Role in 'pg' namespace to read PostgreSQL secrets
apiVersion: rbac.authorization.k8s.io/v1
kind: Role
metadata:
  namespace: pg
  name: secret-reader-pg
rules:
- apiGroups: [""]
  resources: ["secrets"]
  resourceNames: ["pg-ceph-app"]
  verbs: ["get", "list"]

---
# RoleBinding to grant search-infrastructure service account access
apiVersion: rbac.authorization.k8s.io/v1
kind: RoleBinding
metadata:
  namespace: pg
  name: read-pg-secrets
subjects:
- kind: ServiceAccount
  name: default
  namespace: search-infrastructure
roleRef:
  kind: Role
  name: secret-reader-pg
  apiGroup: rbac.authorization.k8s.io

---
# Role in 'redis' namespace to read Redis secrets
apiVersion: rbac.authorization.k8s.io/v1
kind: Role
metadata:
  namespace: redis
  name: secret-reader-redis
rules:
- apiGroups: [""]
  resources: ["secrets"]
  resourceNames: ["redb-mcp-database"]
  verbs: ["get", "list"]

---
# RoleBinding to grant search-infrastructure service account access
apiVersion: rbac.authorization.k8s.io/v1
kind: RoleBinding
metadata:
  namespace: redis
  name: read-redis-secrets
subjects:
- kind: ServiceAccount
  name: default
  namespace: search-infrastructure
roleRef:
  kind: Role
  name: secret-reader-redis
  apiGroup: rbac.authorization.k8s.io

